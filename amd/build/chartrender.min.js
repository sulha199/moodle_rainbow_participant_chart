
define(['jquery'], function ($) {


    return {

        drawChart: function (data) {

            console.log(data);
            // Uncomment to style it like Apple Watch
            /*
             if (!Highcharts.theme) {
             Highcharts.setOptions({
             chart: {
             backgroundColor: 'black'
             },
             colors: ['#F62366', '#9DFF02', '#0CCDD6'],
             title: {
             style: {
             color: 'silver'
             }
             },
             tooltip: {
             style: {
             color: 'silver'
             }
             }
             });
             }
             // */

            var series = [];
            var background = [];
            var chartpos = 110;
            var total_participants = 0;
            data.map(function (item) {
                total_participants += item[1];
            });
            data.map(function (item, index) {
                series[2 * index] = { // this acts as background because, because background configuration provided in pane doesnt support rounded end of the the arc
                    name: item[0],
                    marker: {enabled: false},
                    borderColor: Highcharts.Color(
                            Highcharts.getOptions().colors[index])
                            .setOpacity(0.3)
                            .get(),
                    color: Highcharts.Color(
                            Highcharts.getOptions().colors[index])
                            .setOpacity(0.3)
                            .get(),
                    data: [{
                            color: Highcharts.Color(
                                    Highcharts.getOptions().colors[index])
                                    .setOpacity(0.3)
                                    .get(),
                            radius: chartpos + '%',
                            innerRadius: (chartpos - 14) + '%',
                            y: 100
                        }]
                };
                series[2 * index + 1] = { // this is the real data
                    name: item[0],
                    marker: {enabled: false},
                    showInLegend: true,
                    borderColor: Highcharts.getOptions().colors[index],
                    color: Highcharts.getOptions().colors[index],
                    data: [{
                            color: Highcharts.getOptions().colors[index],
                            radius: chartpos + '%',
                            innerRadius: (chartpos - 14) + '%',
                            y: Math.round(item[1] / total_participants * 100)
                        }]
                };

                chartpos -= 15;
            });

            Highcharts.chart('container', {

                chart: {
                    type: 'solidgauge',
                    marginTop: 50
                },

                legend: {
                    labelFormatter: function () {
                        return '<span style="text-weight:bold;color:' +
                                this.userOptions.color + '">' + this.name +
                                '</span>';
                    },
                    symbolWidth: 0
                },
                title: {
                    text: 'Total Participants : ' + total_participants,
                    style: {
                        fontSize: '24px'
                    }
                },

                tooltip: {
                    borderWidth: 0,
                    backgroundColor: 'none',
                    shadow: false,
                    style: {
                        fontSize: '16px'
                    },
                    pointFormat: '{series.name}<br><span style="font-size:2em; color: {point.color}; font-weight: bold">{point.y}%</span>',
                    positioner: function (labelWidth) {
                        return {
                            x: 200 - labelWidth / 2,
                            y: 180
                        };
                    }
                },

                pane: {
                    startAngle: -90,
                    endAngle: 90,
                    background: background
                },

                yAxis: {
                    min: 0,
                    max: 100,
                    lineWidth: 0,
                    tickPositions: []
                },

                plotOptions: {
                    solidgauge: {
                        dataLabels: {
                            enabled: false
                        },
                        linecap: 'round',
                        stickyTracking: false,
                        rounded: true
                    }
                },

                series: series,
            },
                    /**
                     * In the chart load callback, add icons on top of the circular shapes
                     */
                    );



        }
    }
});
